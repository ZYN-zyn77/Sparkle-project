# 学习洞察与路径预测 (Learning Insights & Path Prediction)

## 1. 概述

学习洞察模块（Insights）是 Sparkle 的前瞻性分析中心。它通过对用户现有知识掌握度的深层推理，利用图论算法（DAG 拓扑排序）预测未来的学习路径，并为用户提供到达任意学习目标的“最短通关攻略”。

---

## 2. 核心算法：图推理引擎 (Graph Reasoning)

### 2.1 拓扑路径生成
- **引擎**: `GraphReasoningService`
- **核心逻辑**: 将知识星图建模为有向无环图 (DAG)，其中边（Edges）代表“前置依赖 (PREREQUISITE)”。
- **搜索算法**: 给定目标知识点 $T$，引擎首先计算 $T$ 在 DAG 中的所有祖先节点（Ancestors），形成一个依赖子图。

### 2.2 个性化剪枝 (Dynamic Pruning)
- **掌握度过滤**: 引擎自动查询 `UserNodeStatus`，将用户掌握度评分 $\ge 80$ 的节点标记为 `mastered`。
- **路径压缩**: 在生成的全局路径中，已掌握的节点会被标记为“已达成”，未掌握且其所有前置节点均已达成的节点标记为 `unlocked`（当前最佳切入点），其余则为 `locked`。

---

## 3. 功能特性

### 3.1 学习路径预测
用户在星图中点击任一未点亮的节点，系统会弹出“预测路径”：
1.  **直观展示**: 以线性化列表或微缩图形式展示通向该目标的知识链条。
2.  **难度预估**: 基于路径长度和节点平均重要度，预估通关所需时间。

### 3.2 学习轨迹回溯
展示用户过去一段时间内的认知成长曲线，并对比“计划路径”与“实际路径”的偏差。

---

## 4. 技术实现

### 4.1 后端服务流
1.  **请求**: `GET /api/v1/learning-paths/{target_node_id}`。
2.  **加载**: 从数据库加载 `PREREQUISITE` 关系至 `NetworkX` 图对象。
3.  **计算**: 调用 `nx.topological_sort` 线性化依赖关系。
4.  **对齐**: 获取当前用户的掌握度数据进行状态标记。

### 4.2 移动端呈现
- **Provider**: `learningPathProvider` 负责异步调用后端 API。
- **UI 组件**: `LearningPathDialog` 展示动态生成的步骤列表，支持一键将路径首位节点添加至“今日任务”。

---

## 5. 未来演进
- **多目标优化**: 支持设定多个学习目标，生成覆盖度最高的复习/预习混合路径。
- **概率预测**: 引入机器学习模型预测用户在特定路径节点上的“卡点”概率。

---
*参考代码*: `backend/app/services/graph_reasoning_service.py` | `mobile/lib/features/insights/`
